<div class="productos container mt-4">
    <h2>Gestión de Productos</h2>

    <form #f="ngForm" (ngSubmit)="guardar(f)" class="mb-5">
        <!-- Campo Código -->
        <div class="mb-3">
            <label for="codigo" class="form-label">Código</label>
            <input type="text" class="form-control" id="codigo" placeholder="A001" 
                   [(ngModel)]="nuevo.codigo" name="codigo" required
                   pattern="^[A-Za-z][0-9]+$" #codigo="ngModel"
                   [class.is-invalid]="codigo.invalid && (codigo.dirty || codigo.touched)">
            <div *ngIf="codigo.invalid && (codigo.dirty || codigo.touched)" class="invalid-feedback">
                <div *ngIf="codigo.errors?.['required']">El código es obligatorio.</div>
                <div *ngIf="codigo.errors?.['pattern']">El código debe empezar con una letra seguida de números (ej. A001).</div>
            </div>
        </div>

        <!-- Campo Nombre -->
        <div class="mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input type="text" class="form-control" id="nombre" placeholder="Nombre del producto"
                   [(ngModel)]="nuevo.nombre" name="nombre" required minlength="5" #nombre="ngModel"
                   [class.is-invalid]="nombre.invalid && (nombre.dirty || nombre.touched)">
            <div *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)" class="invalid-feedback">
                <div *ngIf="nombre.errors?.['required']">El nombre es obligatorio.</div>
                <div *ngIf="nombre.errors?.['minlength']">El nombre debe tener al menos 5 caracteres.</div>
            </div>
        </div>

        <!-- Campo Costo -->
        <div class="mb-3">
            <label for="costo" class="form-label">Costo</label>
            <input type="number" class="form-control" id="costo" placeholder="0.00"
                   [(ngModel)]="nuevo.costo" name="costo" required min="0.01" #costo="ngModel"
                   [class.is-invalid]="costo.invalid && (costo.dirty || costo.touched)">
            <div *ngIf="costo.invalid && (costo.dirty || costo.touched)" class="invalid-feedback">
                <div *ngIf="costo.errors?.['required']">El costo es obligatorio.</div>
                <div *ngIf="costo.errors?.['min']">El costo debe ser mayor a cero.</div>
            </div>
        </div>

        <!-- Campo Precio -->
        <div class="mb-3">
            <label for="precio" class="form-label">Precio</label>
            <input type="number" class="form-control" id="precio" placeholder="0.00"
                   [(ngModel)]="nuevo.precio" name="precio" required min="10" max="100" #precio="ngModel"
                   [class.is-invalid]="precio.invalid && (precio.dirty || precio.touched)">
            <div *ngIf="precio.invalid && (precio.dirty || precio.touched)" class="invalid-feedback">
                <div *ngIf="precio.errors?.['required']">El precio es obligatorio.</div>
                <div *ngIf="precio.errors?.['min'] || precio.errors?.['max']">El precio debe estar entre 10 y 100.</div>
            </div>
        </div>

        <!-- Campo Valor -->
        <div class="mb-3">
            <label for="valor" class="form-label">Valor</label>
            <input type="number" class="form-control" id="valor" placeholder="0.00"
                   [(ngModel)]="nuevo.valor" name="valor" required #valor="ngModel"
                   [class.is-invalid]="valor.invalid && (valor.dirty || valor.touched)">
            <div *ngIf="valor.invalid && (valor.dirty || valor.touched)" class="invalid-feedback">
                <div *ngIf="valor.errors?.['required']">El valor es obligatorio.</div>
            </div>
        </div>

        <!-- Botones de Acción -->
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary" [disabled]="f.invalid">{{ editando ? 'Actualizar' : 'Agregar' }}</button>
            <button type="button" class="btn btn-outline-secondary" (click)="cancelar()" *ngIf="editando">Cancelar</button>
        </div>
    </form>

    <div *ngIf="cargando" class="text-center p-5">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
    </div>

    <table *ngIf="!cargando" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>Código</th>
                <th>Nombre</th>
                <th>Costo</th>
                <th>Precio</th>
                <th>Valor</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let p of productos">
                <td>{{ p.id }}</td>
                <td>{{ p.codigo }}</td>
                <td>{{ p.nombre }}</td>
                <td>{{ p.costo | currency }}</td>
                <td>{{ p.precio | currency }}</td>
                <td>{{ p.valor | currency }}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary me-2" (click)="editar(p)">Editar</button>
                    <button class="btn btn-sm btn-outline-danger" (click)="eliminar(p.id)">Eliminar</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>